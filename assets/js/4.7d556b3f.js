(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{279:function(e,t,s){e.exports=s.p+"assets/img/yarn-jsdom-node-version-error-1.b0f2f262.png"},280:function(e,t,s){e.exports=s.p+"assets/img/yarn-jsdom-node-version-error-2.09c006cb.png"},281:function(e,t){e.exports="data:image/png;base64,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"},299:function(e,t,s){"use strict";s.r(t);var n=s(14),v=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"谈yarn和node版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#谈yarn和node版本"}},[e._v("#")]),e._v(" 谈yarn和node版本")]),e._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),t("p",[e._v("最近在打包一个老项目时，居然报错了，看到报错信息，这令我不可思议\n"),t("img",{attrs:{src:s(279),alt:"yarn-jsdom-node-version-error-1.png"}}),e._v("\n可以看到报错信息是项目中依赖了"),t("code",[e._v("jsdom@22.1.0")]),e._v("，最低支持node 16以上的版本，使用14.17.5这个版本安装所以报错了。")]),e._v(" "),t("h2",{attrs:{id:"_1-追究问题来源-错误分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-追究问题来源-错误分析"}},[e._v("#")]),e._v(" "),t("s",[e._v("1. 追究问题来源（错误分析）")])]),e._v(" "),t("p",[t("s",[e._v("我明确知道自己没有添加任何依赖，也没有修改任何依赖，为什么会出现这个问题呢？\n经过我的分析我发现，依赖关系如下：")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("-- umi-plugin-react: ^1.4.0\n    -- antd-mobile: 2.x\n        -- rc-swipeout: ~2.0.0\n            -- @types/react: latest\n                -- csstype: ^3.0.2\n                    -- jsdom: ^21.1.1\n")])])]),t("p",[t("s",[e._v("我们可以看到"),t("code",[e._v("rc-swipeout")]),e._v("库引入了"),t("code",[e._v("@types/react")]),e._v("库，并且它是引用最新版本的"),t("code",[e._v("@types/react")]),e._v("库。\n这看起来没什么问题，引入"),t("code",[e._v("react")]),e._v("最新的类型，看起来并没有什么问题。然而"),t("code",[e._v("@types/react")]),e._v("库依赖"),t("code",[e._v("csstype")]),e._v("库，这个库就是提供css的类型聚合。\n然而"),t("code",[e._v("csstype: ^3.0.2")]),e._v("这个库的引入却有一大堆的依赖项，一个单纯提供css类型的库居然有这么多依赖项？")]),e._v(" "),t("img",{attrs:{src:s(280),alt:"yarn-jsdom-node-version-error-2.png"}})]),e._v(" "),t("h2",{attrs:{id:"_2-csstype库分析-错误分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-csstype库分析-错误分析"}},[e._v("#")]),e._v(" "),t("s",[e._v("2. csstype库分析（错误分析）")])]),e._v(" "),t("p",[t("s",[e._v("看看"),t("code",[e._v("csstype")]),e._v("是怎么拿到类型的，为什么会需要这么多依赖项呢？")])]),e._v(" "),t("blockquote",[t("p",[t("s",[e._v("https://github.com/frenic/csstype")])])]),e._v(" "),t("p",[t("s",[e._v("我们可以看到"),t("code",[e._v("csstype")]),e._v("库它其实是一个自动维护的库，什么意思呢？就是它会自动从"),t("code",[e._v("MDN")]),e._v("上抓取最新的css类型，然后生成对应的类型文件。\n也就是说这两个类型文件是通过代码生成的，不是手动维护的。它为了解析"),t("code",[e._v("MDN")]),e._v("上的HTML，它引入了"),t("code",[e._v("jsdom")]),e._v("库，解析对应的HTML，然后分析再生成对应的类型文件。")])]),e._v(" "),t("p",[t("s",[e._v("它的拉取和分析的过程会用到非常多的依赖。然而我觉得它并不能将这些依赖都上传到npm上，因为这些依赖并不是它的核心功能，它的核心功能是生成类型文件。\n其实它的package.json只需要"),t("code",[e._v('"types": "index.d.ts",')]),e._v("就够了。")])]),e._v(" "),t("h3",{attrs:{id:"_3-复现问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-复现问题"}},[e._v("#")]),e._v(" 3. 复现问题")]),e._v(" "),t("p",[e._v("上述2步分析思路没有错，但是呢。"),t("code",[e._v("csstype")]),e._v("库中的"),t("code",[e._v("jsdom")]),e._v("引入是放在"),t("code",[e._v("devDependencies")]),e._v("中的，实际不会去校验和安装这个npm库。")]),e._v(" "),t("p",[t("strong",[e._v("什么时候会发生包版本和node版本校验不通过呢？")]),e._v(" 这让我无法好奇，我继续往下探究，先从npm如何管理包开始。")]),e._v(" "),t("p",[e._v("最终追踪结果：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("-- umi-build-dev: ^1.18.9\n    -- af-webpack: 1.14.9\n        -- @svgr/core: 3.1.0\n            -- h2x-core: ^1.1.1\n                -- h2x-parse: ^1.1.1\n                    -- jsdom: >=11.0.0\n")])])]),t("p",[e._v("最终是"),t("code",[e._v("h2x-parse")]),e._v("引入的"),t("code",[e._v("jsdom")]),e._v("库需要设定的版本需要大于 11.0.0 版本。")]),e._v(" "),t("h4",{attrs:{id:"_3-1-问题原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-问题原因"}},[e._v("#")]),e._v(" 3.1 问题原因")]),e._v(" "),t("p",[t("code",[e._v("h2x-parse")]),e._v("引入的"),t("code",[e._v("jsdom")]),e._v("库需要设定的版本需要大于 11.0.0 版本，导致在安装时选择了当前最后的一个LTS版本22.1.0。在这个版本开发者升级了一些功能，\n导致其限制了node版本为16.0.0以上，应该是使用了node版本的一些新特性。")]),e._v(" "),t("p",[e._v("这个问题就有点意思了，所以为什么会有些老的版本安装不上，开源社区贡献的代码大部分都不会强制锁版本，正常只会锁到y（x.y.z)。其实还是有风险的，\n我建议开发者都应该锁版本，推送z版本的更改必须要求是兼容的。这样应该会让所有开发者收益。")]),e._v(" "),t("h4",{attrs:{id:"_3-2-解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解决方案"}},[e._v("#")]),e._v(" 3.2 解决方案")]),e._v(" "),t("ol",[t("li",[e._v("使用"),t("code",[e._v("yarn install --ignore-engines")]),e._v("安装")]),e._v(" "),t("li",[e._v("使用"),t("code",[e._v("npm i")]),e._v("安装\n"),t("img",{attrs:{src:s(281),alt:"yarn-jsdom-node-version-error-3.png"}})])]),e._v(" "),t("p",[e._v("npm 只会给警告，比较友好。")]),e._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),t("p",[e._v("上面说明了node版本和包版本的问题，遇到该问题需要通过报错信息找到触发的依赖项，并提供两种简单的解决方案。\n要想完全避免这个问题，建议开源开发者锁版本（根源还是npm包管理设计的有缺陷）。")]),e._v(" "),t("p",[t("em",[e._v("ps: 后续我会深入的写一下"),t("code",[e._v("npm")]),e._v("的包管理设计缺陷和那糟糕"),t("code",[e._v("node_modules")]),e._v("文件夹。")])])])}),[],!1,null,null,null);t.default=v.exports}}]);