<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>frida介绍和基本使用 | jkcs 随记</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/jkcs-blog/assets/css/0.styles.ffa3548c.css" as="style"><link rel="preload" href="/jkcs-blog/assets/js/app.ee031cb1.js" as="script"><link rel="preload" href="/jkcs-blog/assets/js/2.15dacd45.js" as="script"><link rel="preload" href="/jkcs-blog/assets/js/13.fd5e9907.js" as="script"><link rel="prefetch" href="/jkcs-blog/assets/js/10.8a1f71f0.js"><link rel="prefetch" href="/jkcs-blog/assets/js/11.b9b812b8.js"><link rel="prefetch" href="/jkcs-blog/assets/js/12.9daae80c.js"><link rel="prefetch" href="/jkcs-blog/assets/js/14.25db5a46.js"><link rel="prefetch" href="/jkcs-blog/assets/js/15.6504401e.js"><link rel="prefetch" href="/jkcs-blog/assets/js/3.6ea155a5.js"><link rel="prefetch" href="/jkcs-blog/assets/js/4.1fd738d5.js"><link rel="prefetch" href="/jkcs-blog/assets/js/5.66d20a85.js"><link rel="prefetch" href="/jkcs-blog/assets/js/6.3a5da5f7.js"><link rel="prefetch" href="/jkcs-blog/assets/js/7.46265447.js"><link rel="prefetch" href="/jkcs-blog/assets/js/8.7847c152.js"><link rel="prefetch" href="/jkcs-blog/assets/js/9.94f9ca7f.js">
    <link rel="stylesheet" href="/jkcs-blog/assets/css/0.styles.ffa3548c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jkcs-blog/" class="home-link router-link-active"><!----> <span class="site-name">jkcs 随记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>随记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jkcs-blog/essay/code-review.html" class="sidebar-link">议code review</a></li><li><a href="/jkcs-blog/essay/reflections-on-reverse.html" class="sidebar-link">对逆向工作的一些想法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>逆向与破解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jkcs-blog/hack/frida.html" aria-current="page" class="active sidebar-link">frida介绍和基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jkcs-blog/hack/frida.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/jkcs-blog/hack/frida.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/jkcs-blog/hack/frida.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/jkcs-blog/hack/unity-Il2cpp.html" class="sidebar-link">unity-I2cpp逆向</a></li><li><a href="/jkcs-blog/hack/android-inject.html" class="sidebar-link">Android 注入的三种注入方式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js相关内容</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jkcs-blog/js/utils.html" class="sidebar-link">一些好用的js代码</a></li><li><a href="/jkcs-blog/js/react-to-print.html" class="sidebar-link">打印分页处理（react-to-print）</a></li></ul></section></li><li><a href="/jkcs-blog/about.html" class="sidebar-link">关于此博客</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frida介绍和基本使用"><a href="#frida介绍和基本使用" class="header-anchor">#</a> frida介绍和基本使用</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>frida是什么，frida是一个python库，可运行在android、ios、linux、win、osx等各平台，使用动态二进制插桩技术可以对运行时程序进行操作（对程序行为进行实时监控和修改，插入或替换函数、变量等等）。</p> <blockquote><p><a href="https://github.com/frida/frida/releases" target="_blank" rel="noopener noreferrer">frida-github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://frida.re/" target="_blank" rel="noopener noreferrer">frida-doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>官方介绍：</p> <blockquote><p>Dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers.
(面向开发人员、逆向工程师和安全研究人员的动态检测工具包。)</p></blockquote> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>这里使用py3.9，pip安装：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> frida-tools
</code></pre></div><p>安装frida-tools后会自动安装frida，frida-tools是frida的命令行工具，frida是python库。</p> <p>安装完成后可以使用frida命令查看版本：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>frida <span class="token parameter variable">--version</span>
</code></pre></div><p>下载server端：<a href="https://github.com/frida/frida/releases" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，选择合适的平台和版本下载。</p> <p>frida的server一定要和本地的frida版本一致，否则会出现连接不上的问题。</p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <p>使用前先启动frida-server：</p> <p>安卓手机需要root、ios需要越狱，linux、win、osx不需要。
将server push到设备上，在设备执行：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./frida-server
</code></pre></div><h3 id="frida命令行"><a href="#frida命令行" class="header-anchor">#</a> frida命令行</h3> <p>frida命令行工具可以用来查看设备、进程、应用信息，也可以用来启动frida脚本。(这里以安卓为例)</p> <p>查看设备：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>frida-ls-devices
</code></pre></div><p>查看进程：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>frida-ps <span class="token parameter variable">-U</span>
</code></pre></div><p>查看应用信息：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>frida-ps <span class="token parameter variable">-Ua</span>
</code></pre></div><p>启动frida脚本：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># -U 表示使用usb连接设备，-f 表示指定应用包名，-l 表示指定脚本文件 </span>
<span class="token comment"># --pause 表示启动后暂停，等待attach，--pause 为新版本的参数等同于 --no-pause</span>
frida <span class="token parameter variable">-U</span> <span class="token parameter variable">-f</span> com.example.app <span class="token parameter variable">-l</span> script.js <span class="token parameter variable">--pause</span>
<span class="token comment"># 或者 -F 表示当前设备上的前台应用</span>
frida <span class="token parameter variable">-UF</span> <span class="token parameter variable">-l</span> script.js
</code></pre></div><h3 id="frida脚本"><a href="#frida脚本" class="header-anchor">#</a> frida脚本</h3> <p>frida脚本是一个js文件，可以使用js或python编写。</p> <p>python脚本:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> frida
<span class="token keyword">import</span> sys

jscode <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
    console.log('start hook')
    // some code
&quot;&quot;&quot;</span>

<span class="token keyword">def</span> <span class="token function">on_message</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> message<span class="token punctuation">[</span><span class="token string">'payload'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> frida<span class="token punctuation">.</span>get_remote_device<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pid <span class="token operator">=</span> device<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;your app package name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    session <span class="token operator">=</span> device<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>pid<span class="token punctuation">)</span>
    device<span class="token punctuation">.</span>resume<span class="token punctuation">(</span>pid<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    script <span class="token operator">=</span> session<span class="token punctuation">.</span>create_script<span class="token punctuation">(</span>jscode<span class="token punctuation">)</span>

    script<span class="token punctuation">.</span>on<span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> on_message<span class="token punctuation">)</span>
    script<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>js脚本:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 拦截在String对象，在构造函数中输出参数</span>
Java<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> JavaString <span class="token operator">=</span> Java<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'java.lang.String'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  JavaString<span class="token punctuation">.</span>$init<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">'java.lang.String'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JavaString.$init.overload(\'java.lang.String\')-&gt;'</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$init</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  JavaString<span class="token punctuation">.</span>$init<span class="token punctuation">.</span><span class="token function">overload</span><span class="token punctuation">(</span><span class="token string">'[C'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">implementation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JavaString.$init.overload(\'[C\')-&gt;'</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$init</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>js脚本注意事项：</p> <ol><li>hook java层方法，需要使用<code>Java.perform</code>包裹，否则会<strong>报错</strong>。</li> <li>hook so层方法，建议使用<code>setImmediate</code>包裹。</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/18/2023, 7:53:59 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jkcs-blog/essay/reflections-on-reverse.html" class="prev">
        对逆向工作的一些想法
      </a></span> <span class="next"><a href="/jkcs-blog/hack/unity-Il2cpp.html">
        unity-I2cpp逆向
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jkcs-blog/assets/js/app.ee031cb1.js" defer></script><script src="/jkcs-blog/assets/js/2.15dacd45.js" defer></script><script src="/jkcs-blog/assets/js/13.fd5e9907.js" defer></script>
  </body>
</html>
